#!/usr/bin/with-contenv bashio

# create folders
mkdir -p \
	"${NEXTCLOUD_PATH}" \
	/config/crontabs

# install app
if [ ! -e "${NEXTCLOUD_PATH}/index.php" ]; then
	tar xf /app/nextcloud.tar.bz2 -C \
		"${NEXTCLOUD_PATH}" --strip-components=1
	chmod +x "${NEXTCLOUD_PATH}/occ"
fi

# set cronjob
[[ ! -f /config/crontabs/root ]] && \
	cp /defaults/root /config/crontabs/root
cp /config/crontabs/root /etc/crontabs/root


# copy config
[[ ! -f /data/www/nextcloud/config/config.php ]] && \
	cp /defaults/config.php /data/www/nextcloud/config/config.php
